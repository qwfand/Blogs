# 计算机网络

## 路由器

实现分组交换的关键构建，其任务是转发收到的分组

处理分组的过程：
- 把收到的分组先放入缓存
- 查找转发表，找到某个目的地址应从哪个端口转发
- 把分组送到合适的端口转发出去

## 体系结构

TCP/IP 是四层：应用层、运输层、网际层、网络接口层

五层协议（教学）：应用层、运输层、网络层、数据链路层、物理层

|层名|功能|协议|数据|描述|
|:-  |:-  |:-  |:- |:-  |
|应用层|确定进程间通讯的性质以满足用户需求|HTTP、SMTP、FTP等|提供应用进程所需的信息交换和远程操作|做什么|
|运输层|负责进程间通讯，端到端数据传输|TCP、UDP|报文段、用户数据报|对方在那|
|网络层|负责主机间通讯（分组传送，路由选择，流量控制）|无连接的网际协议IP、地址解析协议ARP|IP数据报|走那条路可以到达对方|
|数据链路层|相邻结点无差错地传送帧|停止等待协议、HDLC、PPP协议|帧frame|每一步该怎么走|
|物理层|在物理谋体上透明传输比特流|接口标准|比特流|怎样利用物理媒体|

## 数据链路层

### 使用点对点信道的数据链路层

一对一的点对点通信

#### 数据链路和帧

#### 三个基本问题

封装成帧

加上首部和尾部

透明传输
    字节填充

差错控制

循环冗余检验

### 点对点协议PPP


### 使用广播信道的数据链路层

一对多的广播通信
CSMA/CD协议：载波监听多点接入/碰撞检测

### 扩展的以太网

### 高速以太网


### 无线局域网

## 网络层

### 网络层提供的两种服务

无连接的、尽最大努力交付的数据服务

### 网际协议IP

与ip协议配套的还有三个协议：
- 地址解析协议ARP（Address Resolution Protocol）
- 网际控制报文协议ICMP（Internet Control Message Protocol）
- 网际组管理协议IGMP（Internet Group Management Protocol）

#### 虚拟互联网络

如何将异构的网络互相连接起来？
使用中间设备：
物理层：转发器
数据链路层：网桥或桥接器
网络层：路由器
网桥和路由器的混合物：桥路器
网络层以上：网关

#### 分类的IP地址

IPv4 32 bits 4bytes
IPv6 128 bits 16bytes

ip地址=net-id + host-id

A类 ：0（前导码）+7 bits net-id--》1. ~ 127.
B类：10（前导码）14 bits net-id--》128.0 ~ 191.255
C类：110+21 bits net-id---》192.0.0 ~223.255.255
D类：1110+多播地址

路由器转发分组的步骤：
- net-id找到目的网络
- 到达目的网络 host-id交付主机

#### IP地址与硬件地址

硬件地址（MAC地址）-数据链路层和物理层
IP地址-网络层及以上，是一种逻辑地址
路由器根据目的站的IP地址的网络号进行路由选择

#### 地址解析协议ARP

从网络层使用的IP地址，解析出在数据链路层使用的硬件地址

每一个主机都有一个ARP高速缓存，里面有所在局域网上个主机和路由器的ip地址到硬件的地址的映射

(IP address,MAC address,TTL)
TTL(time to live)地址映射有效时间

当主机A欲向本局域网上某个主机B发送IP数据报时，先查看ARP cache

- 有，将硬件地址写入MAC帧，再通过局域网将该MAC帧发往硬件地址
- ARP进程在本局域网广播发送一个ARP请求分组，收到响应分组后，将IP to MAC 的映射写出ARP cache

注：
- ARP解决同一个局域网上的主机或路由器的IP地址到硬件地址的映射
- 不在同一个局域网时，ARP找到一个本局域网的路由器的硬件地址，然后把分组发送给这个路由器，路由器再把分组发给下一个网络


#### IP数据报的格式

#### IP层转发分组的流程

按主机所在的网络地址来制作路由表
（目的网络地址，下一跳地址）

### 划分子网和构造超网

#### 划分子网

两级IP网络边三层IP网络
IP地址::=(网络号，子网号，主机号)

#### 使用子网掩码的分组转发过程

使用子网掩码可以得出网络号和子网号
路由表变成（网络号，子网掩码，下一跳地址）

#### 无分类编码CIDR，构造超网

### 网际控制报文协议ICMP

### 互联网的路由选择协议

### IP多播

### 虚拟专用网VPN和网络地址转换NAT

### IPv6
